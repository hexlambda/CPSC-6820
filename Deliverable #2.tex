\documentclass{article}

\usepackage{graphicx}
\usepackage{booktabs}
\usepackage{array}
\usepackage{lscape}
\usepackage{tikz}
\usetikzlibrary{shapes.geometric, shapes.misc, positioning, arrows}
\usepackage{float}
\usepackage{tabularx}
\usepackage[colorlinks=true,urlcolor=blue,bookmarksopen=true]{hyperref}
\usepackage{ltxtable}

\title{Automatic Pet Feeder\\
\large CPSC-6820 Deliverable \#2---System Overview Document}
\author{Logan Swoyer \and Sriram Vishnubhotla}
\date{February 2025}

\begin{document}

\maketitle

\section{Executive Summary}
It feels terrible to realize we did not feed our pets---whether it is because we were running late and were in a hurry or had too much on our mind and forgot about it. Times like these are when the Automatic Pet Feeder comes in handy. It comes with a nifty set of features to take care of your pet feeding needs including---the ability to set multiple food dispense times a day, on-device dispense schedule settings, internet connectivity to pair your mobile devices and publish logs, a mobile app to receive notifications and view logs as well as to set the dispense schedule and the ability to set dispense quantities per each dispense time. Internet connectivity is completely optional and is helpful to check logs and remotely edit the dispense schedule.

\section{System Description}
\subsection{Software}
The device's main loop can be logically divided into three phases: reading from and writing to I/O---including rendering on-device display based on button inputs and activating the buzzer, pushing device state to the web server and updating the local state from the web server's state, setting the timers based on the schedules and dispensing food when the timers are triggered. The following sections lay out more details of these phases.
\subsubsection{Device I/O}
For the device to be self-sufficient without internet connectivity, the on-device display needs to act as a comprehensive user interface. <figure> shows the planned frame layout. The frame consists of a number input at the center to take schedule times and portion sizes as inputs, icons on the left---including internet connectivity indicator, storage level indicator and schedule identifier. The schedule identifier can be toggled to view or edit multiple schedules, each of which is identified by the identifier. The display would be controlled using a joystick--select button combo input and a buzzer would be fired to alert the pet/user when dispensing food.
\subsubsection{Web Interoperation}
The device would be equipped with a Wi-Fi module that sets up a private wireless network to pair with a mobile device, which needs a client app installed. The user's home network credentials will then be exchanged with the device for it to establish a connection with the network. Once this step succeeds, the device would be ready to go online and synchronize device state with data on the server. This includes the device clock and the dispense schedule and portion sizes. From this point, the device would push activity data to the server---which would be used by the mobile app, for instance, to notify the user when food is dispensed or if the storage level is low.
\subsubsection{Scheduling and Dispensing}
% TODO: Research on MSP430 timer limits and check if a dedicated timer is required.
Schedules are set using the microcontroller's online timers. The timer interrupts trigger the device to serve food in the container.
\subsection{State Machine}
\begin{figure}[H]
    \centering
    \tikzstyle{terminal} = [rounded rectangle,
    minimum width=5em,
    minimum height=2em,
    text centered,
    draw,
    fill=red!10]

    \tikzstyle{io} = [trapezium,
    trapezium stretches=true,
    trapezium left angle=-75,
    trapezium right angle=-75,
    minimum width=7.5em,
    minimum height=2.5em,
    text centered,
    draw,
    fill=blue!10]

    \tikzstyle{process} = [rectangle,
    minimum width=7.5em,
    minimum height=2.5em,
    text centered,
    text width=3cm,
    draw,
    fill=gray!20]

    \tikzstyle{decision} = [diamond,
    minimum width=2.5em,
    minimum height=2.5em,
    aspect=1.5,
    inner sep=1,
    text centered,
    draw,
    fill=orange!10]
    \tikzstyle{arrow} = [->,>=stealth]
    \begin{tikzpicture}[node distance=2.25em]
        \node (start) [terminal] {Start};
        \node (inclock) [io, below=of start, text width=2.5cm] {Time input to set device clock};
        \node (inschedule) [io, below=of inclock, text width=3.5cm] {Dispense schedule and portion size input};

        \node (netcond) [decision, right=1.5 of start, text width=2.5cm] {Connected to internet?};
        \node (srvconn) [process, below=of netcond] {Connect to server and fetch data};

        \node (wait) [terminal, below=of inschedule] {Wait};

        \node (predispchk) [process, below=of wait] {Check remaining food in storage};
        \node (predispcond) [decision, below=of predispchk, text width=2.5cm] {Sufficient food in storage?};
        \node (predispwarn) [io, right=of predispcond, text width=2.5cm] {Alert the user and display indicator};

        \node (dispfood) [process, below=of predispcond] {Dispense food---portion size minus leftovers in the dispense container};

        \node (dispalrt) [io, below=of dispfood] {Notify the user};

        \node (postdispchk) [process, left=of dispalrt] {Check remaining food in storage};
        \node (postdispcond) [decision, above=of postdispchk, text width=2.5cm] {Sufficient food in storage?};
        \node (postdispwarn) [io, above=of postdispcond, text width=2.5cm] {Alert the user and display indicator};

        \node (stop) [terminal, below=of dispalrt] {Stop};

        \draw [arrow] (start) -- (inclock);
        \draw [arrow] (inclock) -- (inschedule);
        \draw [arrow] (inschedule) -- (wait);

        \draw [arrow] (start) -- (netcond);
        \draw [arrow] (netcond.east) -- node[above] {Yes} +(0.5,0) |- (srvconn);
        \draw [arrow] (netcond) |- node[right] {No} (inclock);
        \draw [arrow] (srvconn) -- +(0,-1.75) -| (wait);

        \draw [arrow] (wait) -- node[left] {Timer trigger} (predispchk);
        \draw [arrow] (predispchk) -- (predispcond);
        \draw [arrow] (predispcond) -- node[left] {Yes} (dispfood);
        \draw [arrow] (predispcond) -- node[above] {No} (predispwarn);
        \draw [arrow] (predispwarn) |- (wait);

        \draw [arrow] (dispalrt) -- (postdispchk);
        \draw [arrow] (postdispchk) -- (postdispcond);
        \draw [arrow] (postdispcond) -- node[left] {No} (postdispwarn);
        \draw [arrow] (postdispwarn) |- (wait);

        \draw [arrow] (dispfood) -- (dispalrt);
        \draw [arrow] (dispalrt) -- (stop);
    \end{tikzpicture}
    \caption{Automatic Pet Feeder's state machine.}
\end{figure}
\subsection{Hardware}
\subsection{Parts}
\begin{table}[H]
    \begin{tabularx}{\linewidth}{@{} X X >{\raggedleft\hsize=0.25\hsize}X X @{}}
        \toprule
        Title                                                                                                                          & Part \#                   & Price & Supplier              \\ \midrule
        \href{https://www.sparkfun.com/rocker-switch-spst-round.html}{Rocker Switch}                                                   & COM-11138                 & 0.55  & Sparkfun              \\ \midrule
        \href{https://www.adafruit.com/product/512}{Joystick with Select Button}                                                       & 512                       & 5.95  & Adafruit              \\ \midrule
        \href{https://www.digikey.com/en/products/detail/tdk-corporation/PS1240P02BT/935924}{Buzzer}                                   & PS1240P02BT               & 0.55  & TDK Corporation       \\ \midrule
        \href{https://www.digikey.com/en/products/detail/newhaven-display-intl/NHD-C12832A1Z-NSW-BBW-3V3/2059235}{Graphic LCD Display} & NHD-C12832A1Z-NSW-BBW-3V3 & 12.82 & Newhaven Display Intl \\ \midrule
        \href{https://www.digikey.com/en/products/detail/espressif-systems/ESP32-S2FH4/14553010}{WiFi Module}                          & ESP32-S2FH4               & 1.48  & Espressif Systems     \\ \midrule
        \href{https://www.digikey.com/en/products/detail/dfrobot/FIT0803/14824998}{Linear actuator}                                    & FIT0803                   & 24.00 & DFRobot               \\ \midrule
        \href{https://www.digikey.com/en/products/detail/texas-instruments/MSP-EXP430FR5994/6645208}{MSP430FR5994 Microcontroller}     & MSP-EXP430FR5994          & 20.39 & Texas Instruments     \\ \midrule
        \href{https://www.digikey.com/en/products/detail/uneo-inc/GHF-10/15657152}{Force sensor}                                       & GHF-10                    & 5.86  & UNEO Inc.             \\ \midrule
        \href{https://www.digikey.com/en/products/detail/stmicroelectronics/VL6180V1NR-1/7313209}{Optical sensor}                      & VL6180V1NR/1              & 3.37  & STMicroelectronics    \\ \midrule
                                                                                                                                       &                           & 74.97 &                       \\ \bottomrule
    \end{tabularx}
    \caption{Device part list and their details.}
\end{table}
\section{Resources, References and Appendix}
\end{document}
